apiVersion: v1
kind: Secret
metadata:
    name: "psql-{{ psql_name }}-config"
    namespace: "{{ psql_namespace }}"
type: Opaque
data:
{% if psql_pass_key is not defined %}
    PGPASSWORD: "{{ psql_pass | b64encode }}"
{% endif %}
{% if psql_user_key is not defined  %}
    PGUSER: "{{ psql_user | b64encode }}"
{% endif %}
    PGHOST: "{{ psql_host | b64encode }}"
    DB_NAME: "{{ psql_db_name | b64encode }}"
    DB_CUSTOM_COMMAND: "{{ psql_db_custom_command | b64encode }}"
{% for user in psql_db_users %}
    DB_{{ user.name | upper }}_USER_PASS: "{{ user.password | b64encode }}"
{% endfor %}